<%
  const currentPath = (req && (req.path || req.originalUrl)) || "/";
  const isActive = (path) => currentPath === path || currentPath.startsWith(path + "/");
%>

<div class="wrapper">
  <nav>
    <input type="checkbox" id="show-menu">
    <label for="show-menu" class="menu-icon"><i class="fas fa-bars"></i></label>

    <div class="content">
      <a class="brand" href="/">
        <img src="<%= botClient.user.displayAvatarURL({ size: 128 }) %>" alt="<%= botClient.user.username %>">
        <span><%= botClient.user.username %> Dashboard</span>
      </a>

      <ul class="links">
        <li><a href="/" class="<%= isActive('/') && !isActive('/dashboard') && !isActive('/commands') && !isActive('/queue') && !isActive('/queuedashboard') ? 'active-link' : '' %>">Inicio</a></li>
        <li><a href="/commands" class="<%= isActive('/commands') ? 'active-link' : '' %>">Comandos</a></li>
        <li><a href="/dashboard" class="<%= isActive('/dashboard') ? 'active-link' : '' %>">Dashboard</a></li>
        <li><a href="/queuedashboard" class="<%= isActive('/queuedashboard') || isActive('/queue') ? 'active-link' : '' %>">Fila</a></li>
        <li><a href="https://discord.com/oauth2/authorize?client_id=<%= botClient.user.id %>&scope=bot%20applications.commands&permissions=2102658175" target="_blank" rel="noopener noreferrer">Convite</a></li>
        <li>
          <a
            href="https://github.com/Programador-jr/King"
            target="_blank"
            rel="noopener noreferrer"
            class="icon-link"
            aria-label="GitHub"
            title="GitHub"
          >
            <i class="fab fa-github"></i>
          </a>
        </li>

        <li class="nav-auth">
          <% if (user && user.id) { %>
            <% const avatarUrl = user.avatar
              ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.webp?size=64`
              : `https://cdn.discordapp.com/embed/avatars/${Number(user.discriminator || 0) % 5}.png`; %>
            <button
              class="auth-btn auth-btn-danger"
              onclick="location.href='/logout'"
              type="button"
            >
              <img src="<%= avatarUrl %>" alt="avatar">
              Logout
            </button>
          <% } else { %>
            <button
              class="auth-btn"
              onclick="location.href='/login?redirect=<%= encodeURIComponent(currentPath) %>'"
              type="button"
            >
              Login
            </button>
          <% } %>
        </li>
      </ul>
    </div>
  </nav>
</div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  let myParam = urlParams.get('error');
  if (myParam) alert(myParam);
  myParam = urlParams.get('success');
  if (myParam) alert(myParam);
</script>
